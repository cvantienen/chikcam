{% load static %}
<div class="container">
  <div class="row justify-content-center">
    <h5 class="pink-gradient text-center mb-1">Chikcam Radio</h5>
    <div class="col-lg-6">
      <div id="music-player" class="music-player-card">
        <div class="cover-art-container">
          <img id="cover-art" src="#" alt="Cover Art" class="cover-art img-fluid">
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div id="track-info" class="track-info text-center mt-3">
        <div class="info-item mb-2">
          <h6 class="text-muted mb-1">Current Station</h6>
          <p id="station-name" class="fw-bold text-uppercase mb-0">Station Name</p>
        </div>
        <div class="info-item mb-2">
          <h6 class="text-muted mb-1">Song</h6>
          <p id="track-title" class="fw-bold text-uppercase mb-0">Track Title</p>
        </div>
        <div class="info-item mb-2">
          <h6 class="text-muted mb-1">Artist</h6>
          <p id="track-artist" class="fw-bold text-uppercase mb-0">Artist</p>
        </div>
        <div class="info-item mb-2">
          <h6 class="text-muted mb-1">Album</h6>
          <p id="track-album" class="fw-bold text-uppercase mb-0">Album Name</p>
        </div>
      </div>
      <div class="controls">
        <audio id="audio-player">
          <source id="audio-source" src="#" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
        <div class="custom-controls">
          <button id="play-btn" class="btn btn-primary btn-sm my-1">Play</button>
          <button id="pause-btn" class="btn btn-primary btn-sm my-1">Pause</button>
          <input type="range" id="progress-bar" value="0" max="100">
          <input type="range" id="volume-control" value="100" max="100">
        </div>
        <button id="switch-station-btn" class="btn btn-primary btn-sm my-1">
            Next Station
            <img src="{% static 'images/icons/chevron-right.svg' %}" alt="Switch Station" class="me-1">
        </button>
      </div>
    </div>
  </div>  
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
  const audioPlayer = document.getElementById('audio-player');
  const audioSource = document.getElementById('audio-source');
  const stationName = document.getElementById('station-name');
  const trackTitle = document.getElementById('track-title');
  const trackArtist = document.getElementById('track-artist');
  const trackAlbum = document.getElementById('track-album');  // Add this line
  const coverArt = document.getElementById('cover-art');
  const switchStationBtn = document.getElementById('switch-station-btn');

  let currentStationIndex = 0;
  let currentTrackIndex = 0;
  let stations = [];  // Array to store station data fetched from Django

  // Function to load current station and play the first track
  function loadStation(stationIndex) {
      const station = stations[stationIndex];
      stationName.textContent = station.name;
      currentTrackIndex = 0;  // Reset track index when loading a new station
      playTrack(station.tracks[currentTrackIndex]);
  }

  // Function to play a specific track
  function playTrack(track) {
      audioSource.src = track.file_url;  // Assuming 'file_url' is the URL to your audio file
      audioPlayer.load();
      audioPlayer.play();
      trackTitle.textContent = track.title;
      trackArtist.textContent = track.artist;
      coverArt.src = track.cover_art_url;  // Assuming 'cover_art_url' is the URL to your cover art image
  }

  // Event listener for switching stations
  switchStationBtn.addEventListener('click', function() {
      currentStationIndex = (currentStationIndex + 1) % stations.length;
      loadStation(currentStationIndex);
  });

  // Event listener for when the current track ends
  audioPlayer.addEventListener('ended', function() {
      const station = stations[currentStationIndex];
      currentTrackIndex = (currentTrackIndex + 1) % station.tracks.length;
      playTrack(station.tracks[currentTrackIndex]);
  });

  // Fetch stations data from Django backend
  fetch('/music_player/api/stations/')
      .then(response => response.json())
      .then(data => {
          stations = data;
          loadStation(currentStationIndex);  // Load initial station
      })
      .catch(error => console.error('Error fetching stations:', error));
});
</script>