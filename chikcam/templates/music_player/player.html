<!-- music_player/templates/music_player/card.html -->
{% load static %}
<div class="card m-3 p-3 justify-content-center bg-c-dark order-card" id="fizzle_title_2">
    <h5 class="pink-gradient text-center mb-1">Chikcam Radio</h5>
    <div class="card-body">
        <div id="stations" class="d-flex flex-column align-items-center">
            {% for station in stations %}
            <div class="station mb-3 text-center" data-station-id="{{ station.id }}">
                <h6 class="mb-2">{{ station.name }}</h6>
                <button onclick="playStation({{ station.id }})" class="btn btn-primary btn-sm">
                    <img src="{% static 'images/icons/play.svg' %}" alt="Play" class="icon-btn">
                </button>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="card-footer">
        <div id="player" class="mt-1 text-center">
            <audio id="audio-player" controls class="w-75"></audio>
            <div class="d-flex justify-content-around mt-3">
                <button onclick="pause()" class="btn btn-secondary btn-sm">
                    <img src="{% static 'images/icons/pause.svg' %}" alt="Pause" class="icon-btn">
                </button>
                <button onclick="resume()" class="btn btn-secondary btn-sm">
                    <img src="{% static 'images/icons/play.svg' %}" alt="Resume" class="icon-btn">
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    let currentStation = null;
    let audioPlayer = document.getElementById('audio-player');
    function playStation(stationId) {
        if (currentStation !== stationId) {
            currentStation = stationId;
            // Fetch the tracks for the station and start playing
            fetch(`/music/station/${stationId}/tracks/`)
                .then(response => response.json())
                .then(data => {
                    if (data.tracks.length > 0) {
                        audioPlayer.src = data.tracks[0].file;
                        audioPlayer.play();
                    }
                });
        }
    }
    function pause() {
        audioPlayer.pause();
    }
    function resume() {
        audioPlayer.play();
    }
</script>